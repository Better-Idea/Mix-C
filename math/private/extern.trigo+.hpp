#ifdef xuser
    #undef xuser
#endif

#define xuser mixc::math_tan
#include"configure.hpp"
#include"define/mfxx.hpp"
#include"macro/xalign.hpp"
#include"math/tan.hpp"

namespace mixc::math_tan{
    #if xuse_math_tan_lut4x256
    constexpr xalign(4096) f64 lut[][256] = {
        { 0.00000000000000000e+00, 3.90626986833619184e-03, 7.81265894960000764e-03, 1.17192864712722449e-02, 1.56262716899438238e-02, 1.95337339058802886e-02, 2.34417924775976425e-02, 2.73505668364533010e-02, 3.12601765012559564e-02, 3.51707410928981533e-02, 3.90823803490153875e-02, 4.29952141386755494e-02, 4.69093624771025491e-02, 5.08249455404379742e-02, 5.47420836805446493e-02, 5.86608974398559835e-02, 6.25815075662750147e-02, 6.65040350281270801e-02, 7.04286010291700673e-02, 7.43553270236662251e-02, 7.82843347315195430e-02, 8.22157461534827354e-02, 8.61496835864378993e-02, 9.00862696387549478e-02, 9.40256272457319558e-02, 9.79678796851215917e-02, 1.01913150592747850e-01, 1.05861563978217334e-01, 1.09813244240729398e-01, 1.13768316184989469e-01, 1.17726905037229966e-01, 1.21689136461343229e-01, 1.25655136575130968e-01, 1.29625031966674761e-01, 1.33598949710832210e-01, 1.37577017385863413e-01, 1.41559363090192457e-01, 1.45546115459308730e-01, 1.49537403682812890e-01, 1.53533357521612398e-01, 1.57534107325271611e-01, 1.61539784049521476e-01, 1.65550519273933976e-01, 1.69566445219766510e-01, 1.73587694767981521e-01, 1.77614401477446728e-01, 1.81646699603321428e-01, 1.85684724115634412e-01, 1.89728610718059133e-01, 1.93778495866891864e-01, 1.97834516790238669e-01, 2.01896811507417133e-01, 2.05965518848578872e-01, 2.10040778474558981e-01, 2.14122730896958665e-01, 2.18211517498467433e-01, 2.22307280553431331e-01, 2.26410163248673837e-01, 2.30520309704576141e-01, 2.34637864996423679e-01, 2.38762975176025920e-01, 2.42895787293616542e-01, 2.47036449420041265e-01, 2.51185110669240767e-01, 2.55341921221036267e-01, 2.59507032344225470e-01, 2.63680596419996800e-01, 2.67862766965669935e-01, 2.72053698658770883e-01, 2.76253547361449983e-01, 2.80462470145251403e-01, 2.84680625316242891e-01, 2.88908172440514726e-01, 2.93145272370057000e-01, 2.97392087269024589e-01, 3.01648780640399342e-01, 3.05915517353059264e-01, 3.10192463669264671e-01, 3.14479787272571516e-01, 3.18777657296182342e-01, 3.23086244351745520e-01, 3.27405720558613718e-01, 3.31736259573572767e-01, 3.36078036621052375e-01, 3.40431228523830387e-01, 3.44796013734242595e-01, 3.49172572365910352e-01, 3.53561086225998577e-01, 3.57961738848016998e-01, 3.62374715525177839e-01, 3.66800203344323423e-01, 3.71238391220437557e-01, 3.75689469931754840e-01, 3.80153632155482443e-01, 3.84631072504149223e-01, 3.89121987562597448e-01, 3.93626575925632758e-01, 3.98145038236348406e-01, 4.02677577225140212e-01, 4.07224397749429094e-01, 4.11785706834108476e-01, 4.16361713712734296e-01, 4.20952629869475822e-01, 4.25558669081845936e-01, 4.30180047464230049e-01, 4.34816983512233305e-01, 4.39469698147866240e-01, 4.44138414765589621e-01, 4.48823359279239709e-01, 4.53524760169855789e-01, 4.58242848534432367e-01, 4.62977858135619059e-01, 4.67730025452391800e-01, 4.72499589731719670e-01, 4.77286793041252262e-01, 4.82091880323053225e-01, 4.86915099448406325e-01, 4.91756701273721053e-01, 4.96616939697565626e-01, 5.01496071718855930e-01, 5.06394357496229812e-01, 5.11312060408636919e-01, 5.16249447117175145e-01, 5.21206787628205626e-01, 5.26184355357779144e-01, 5.31182427197407698e-01, 5.36201283581216031e-01, 5.41241208554508847e-01, 5.46302489843790513e-01, 5.51385418928275108e-01, 5.56490291112925774e-01, 5.61617405603063476e-01, 5.66767065580586446e-01, 5.71939578281842810e-01, 5.77135255077200154e-01, 5.82354411552357091e-01, 5.87597367591443221e-01, 5.92864447461955298e-01, 5.98155979901578815e-01, 6.03472298206945750e-01, 6.08813740324380721e-01, 6.14180648942689418e-01, 6.19573371588044793e-01, 6.24992260721028249e-01, 6.30437673835884767e-01, 6.35909973562052799e-01, 6.41409527768031606e-01, 6.46936709667650688e-01, 6.52491897928807993e-01, 6.58075476784745681e-01, 6.63687836147934390e-01, 6.69329371726639209e-01, 6.75000485144242908e-01, 6.80701584061404375e-01, 6.86433082301132727e-01, 6.92195399976860153e-01, 6.97988963623599255e-01, 7.03814206332273431e-01, 7.09671567887311731e-01, 7.15561494907602654e-01, 7.21484440990904420e-01, 7.27440866861812530e-01, 7.33431240523388733e-01, 7.39456037412559041e-01, 7.45515740559391995e-01, 7.51610840750372182e-01, 7.57741836695787848e-01, 7.63909235201355515e-01, 7.70113551344208705e-01, 7.76355308653382205e-01, 7.82635039294927867e-01, 7.88953284261802611e-01, 7.95310593568674186e-01, 8.01707526451795340e-01, 8.08144651574102310e-01, 8.14622547235699021e-01, 8.21141801589894122e-01, 8.27703012864963880e-01, 8.34306789591820150e-01, 8.40953750837769051e-01, 8.47644526446552654e-01, 8.54379757284872961e-01, 8.61160095495604649e-01, 8.67986204757910639e-01, 8.74858760554482350e-01, 8.81778450446134704e-01, 8.88745974353994427e-01, 8.95762044849529084e-01, 9.02827387452673502e-01, 9.09942740938319898e-01, 9.17108857651448018e-01, 9.24326503831182116e-01, 9.31596459944072461e-01, 9.38919521026910503e-01, 9.46296497039398639e-01, 9.53728213227007982e-01, 9.61215510494370416e-01, 9.68759245789564747e-01, 9.76360292499670861e-01, 9.84019540857980501e-01, 9.91737898363268680e-01, 9.99516290211545782e-01, 1.00735565974072722e+00, 1.01525696888867503e+00, 1.02322119866508423e+00, 1.03124934963770569e+00, 1.03934244243341776e+00, 1.04750151825467941e+00, 1.05572763941191991e+00, 1.06402188987244302e+00, 1.07238537582644761e+00, 1.08081922627079184e+00, 1.08932459361115464e+00, 1.09790265428327547e+00, 1.10655460939398272e+00, 1.11528168538275119e+00, 1.12408513470456094e+00, 1.13296623653486348e+00, 1.14192629749749568e+00, 1.15096665241641915e+00, 1.16008866509220102e+00, 1.16929372910419238e+00, 1.17858326863940365e+00, 1.18795873934912007e+00, 1.19742162923434797e+00, 1.20697345956123137e+00, 1.21661578580763025e+00, 1.22635019864210648e+00, 1.23617832493662037e+00, 1.24610182881430112e+00, 1.25612241273371793e+00, 1.26624181861114489e+00, 1.27646182898238345e+00, 1.28678426820577974e+00, 1.29721100370815244e+00, 1.30774394727542838e+00, 1.31838505638987036e+00, 1.32913633561587228e+00, 1.33999983803639332e+00, 1.35097766674220454e+00, 1.36207197637622823e+00, 1.37328497473536381e+00, 1.38461892443231361e+00, 1.39607614462004819e+00, 1.40765901278168430e+00, 1.41936996658869011e+00, 1.43121150583048125e+00, 1.44318619441862946e+00, 1.45529666246907291e+00, 1.46754560846589407e+00, 1.47993580151041884e+00, 1.49247008365958899e+00, 1.50515137235777104e+00, 1.51798266296638746e+00, 1.53096703139599356e+00, 1.54410763684567424e+00, },
        { 0.00000000000000000e+00, 1.52587890636842379e-05, 3.05175781344739031e-05, 4.57763672194744231e-05, 6.10351563257912253e-05, 7.62939454605297370e-05, 9.15527346307953857e-05, 1.06811523843693599e-04, 1.22070313106329805e-04, 1.37329102425809430e-04, 1.52587891809237904e-04, 1.67846681263720653e-04, 1.83105470796363106e-04, 1.98364260414270692e-04, 2.13623050124548838e-04, 2.28881839934302972e-04, 2.44140629850638525e-04, 2.59399419880660925e-04, 2.74658210031475600e-04, 2.89917000310187981e-04, 3.05175790723903496e-04, 3.20434581279727577e-04, 3.35693371984765652e-04, 3.50952162846123153e-04, 3.66210953870905510e-04, 3.81469745066218154e-04, 3.96728536439166517e-04, 4.11987327996856029e-04, 4.27246119746392124e-04, 4.42504911694880233e-04, 4.57763703849425789e-04, 4.73022496217134226e-04, 4.88281288805110976e-04, 5.03540081620461475e-04, 5.18798874670291155e-04, 5.34057667961705452e-04, 5.49316461501809802e-04, 5.64575255297709639e-04, 5.79834049356510400e-04, 5.95092843685317522e-04, 6.10351638291236442e-04, 6.25610433181372597e-04, 6.40869228362831426e-04, 6.56128023842718367e-04, 6.71386819628138860e-04, 6.86645615726198345e-04, 7.01904412144002262e-04, 7.17163208888656053e-04, 7.32422005967265158e-04, 7.47680803386935020e-04, 7.62939601154771083e-04, 7.78198399277878789e-04, 7.93457197763363583e-04, 8.08715996618330909e-04, 8.23974795849886215e-04, 8.39233595465134944e-04, 8.54492395471182546e-04, 8.69751195875134467e-04, 8.85009996684096156e-04, 9.00268797905173062e-04, 9.15527599545470636e-04, 9.30786401612094327e-04, 9.46045204112149588e-04, 9.61304007052741871e-04, 9.76562810440976629e-04, 9.91821614283959316e-04, 1.00708041858879539e-03, 1.02233922336259030e-03, 1.03759802861244951e-03, 1.05285683434547847e-03, 1.06811564056878264e-03, 1.08337444728946749e-03, 1.09863325451463847e-03, 1.11389206225140104e-03, 1.12915087050686066e-03, 1.14440967928812281e-03, 1.15966848860229293e-03, 1.17492729845647651e-03, 1.19018610885777900e-03, 1.20544491981330587e-03, 1.22070373133016258e-03, 1.23596254341545462e-03, 1.25122135607628744e-03, 1.26648016931976653e-03, 1.28173898315299734e-03, 1.29699779758308536e-03, 1.31225661261713607e-03, 1.32751542826225492e-03, 1.34277424452554741e-03, 1.35803306141411901e-03, 1.37329187893507520e-03, 1.38855069709552147e-03, 1.40380951590256328e-03, 1.41906833536330613e-03, 1.43432715548485549e-03, 1.44958597627431686e-03, 1.46484479773879572e-03, 1.48010361988539756e-03, 1.49536244272122787e-03, 1.51062126625339213e-03, 1.52588009048899584e-03, 1.54113891543514450e-03, 1.55639774109894358e-03, 1.57165656748749860e-03, 1.58691539460791505e-03, 1.60217422246729843e-03, 1.61743305107275423e-03, 1.63269188043138796e-03, 1.64795071055030512e-03, 1.66320954143661121e-03, 1.67846837309741174e-03, 1.69372720553981222e-03, 1.70898603877091815e-03, 1.72424487279783504e-03, 1.73950370762766840e-03, 1.75476254326752376e-03, 1.77002137972450661e-03, 1.78528021700572249e-03, 1.80053905511827689e-03, 1.81579789406927535e-03, 1.83105673386582338e-03, 1.84631557451502651e-03, 1.86157441602399025e-03, 1.87683325839982014e-03, 1.89209210164962169e-03, 1.90735094578050045e-03, 1.92260979079956193e-03, 1.93786863671391167e-03, 1.95312748353065521e-03, 1.96838633125689807e-03, 1.98364517989974580e-03, 1.99890402946630393e-03, 2.01416287996367800e-03, 2.02942173139897356e-03, 2.04468058377929615e-03, 2.05993943711175131e-03, 2.07519829140344459e-03, 2.09045714666148154e-03, 2.10571600289296771e-03, 2.12097486010500865e-03, 2.13623371830470992e-03, 2.15149257749917707e-03, 2.16675143769551567e-03, 2.18201029890083126e-03, 2.19726916112222942e-03, 2.21252802436681570e-03, 2.22778688864169568e-03, 2.24304575395397491e-03, 2.25830462031075897e-03, 2.27356348771915344e-03, 2.28882235618626387e-03, 2.30408122571919586e-03, 2.31934009632505497e-03, 2.33459896801094678e-03, 2.34985784078397688e-03, 2.36511671465125085e-03, 2.38037558961987428e-03, 2.39563446569695275e-03, 2.41089334288959185e-03, 2.42615222120489717e-03, 2.44141110064997431e-03, 2.45666998123192886e-03, 2.47192886295786642e-03, 2.48718774583489259e-03, 2.50244662987011298e-03, 2.51770551507063318e-03, 2.53296440144355880e-03, 2.54822328899599546e-03, 2.56348217773504876e-03, 2.57874106766782431e-03, 2.59399995880142773e-03, 2.60925885114296465e-03, 2.62451774469954067e-03, 2.63977663947826142e-03, 2.65503553548623252e-03, 2.67029443273055961e-03, 2.68555333121834830e-03, 2.70081223095670424e-03, 2.71607113195273305e-03, 2.73133003421354037e-03, 2.74658893774623184e-03, 2.76184784255791310e-03, 2.77710674865568979e-03, 2.79236565604666755e-03, 2.80762456473795205e-03, 2.82288347473664891e-03, 2.83814238604986381e-03, 2.85340129868470239e-03, 2.86866021264827030e-03, 2.88391912794767322e-03, 2.89917804459001681e-03, 2.91443696258240671e-03, 2.92969588193194862e-03, 2.94495480264574819e-03, 2.96021372473091110e-03, 2.97547264819454302e-03, 2.99073157304374963e-03, 3.00599049928563662e-03, 3.02124942692730966e-03, 3.03650835597587444e-03, 3.05176728643843664e-03, 3.06702621832210196e-03, 3.08228515163397610e-03, 3.09754408638116474e-03, 3.11280302257077359e-03, 3.12806196020990835e-03, 3.14332089930567472e-03, 3.15857983986517841e-03, 3.17383878189552513e-03, 3.18909772540382059e-03, 3.20435667039717050e-03, 3.21961561688268059e-03, 3.23487456486745657e-03, 3.25013351435860417e-03, 3.26539246536322911e-03, 3.28065141788843713e-03, 3.29591037194133395e-03, 3.31116932752902531e-03, 3.32642828465861694e-03, 3.34168724333721459e-03, 3.35694620357192401e-03, 3.37220516536985093e-03, 3.38746412873810110e-03, 3.40272309368378029e-03, 3.41798206021399423e-03, 3.43324102833584870e-03, 3.44849999805644945e-03, 3.46375896938290225e-03, 3.47901794232231285e-03, 3.49427691688178704e-03, 3.50953589306843058e-03, 3.52479487088934926e-03, 3.54005385035164884e-03, 3.55531283146243512e-03, 3.57057181422881387e-03, 3.58583079865789089e-03, 3.60108978475677197e-03, 3.61634877253256289e-03, 3.63160776199236947e-03, 3.64686675314329749e-03, 3.66212574599245277e-03, 3.67738474054694110e-03, 3.69264373681386831e-03, 3.70790273480034019e-03, 3.72316173451346258e-03, 3.73842073596034129e-03, 3.75367973914808214e-03, 3.76893874408379095e-03, 3.78419775077457357e-03, 3.79945675922753582e-03, 3.81471576944978353e-03, 3.82997478144842255e-03, 3.84523379523055872e-03, 3.86049281080329788e-03, 3.87575182817374588e-03, 3.89101084734900858e-03, },
        { 0.00000000000000000e+00, 5.96046447753906956e-08, 1.19209289550781815e-07, 1.78813934326173781e-07, 2.38418579101567018e-07, 2.98023223876961948e-07, 3.57627868652358997e-07, 4.17232513427758586e-07, 4.76837158203161140e-07, 5.36441802978567082e-07, 5.96046447753976836e-07, 6.55651092529390825e-07, 7.15255737304809473e-07, 7.74860382080233203e-07, 8.34465026855662438e-07, 8.94069671631097603e-07, 9.53674316406539121e-07, 1.01327896118198741e-06, 1.07288360595744291e-06, 1.13248825073290602e-06, 1.19209289550837719e-06, 1.25169754028385682e-06, 1.31130218505934535e-06, 1.37090682983484320e-06, 1.43051147461035078e-06, 1.49011611938586853e-06, 1.54972076416139687e-06, 1.60932540893693622e-06, 1.66893005371248701e-06, 1.72853469848804965e-06, 1.78813934326362457e-06, 1.84774398803921220e-06, 1.90734863281481296e-06, 1.96695327759042728e-06, 2.02655792236605557e-06, 2.08616256714169825e-06, 2.14576721191735576e-06, 2.20537185669302852e-06, 2.26497650146871695e-06, 2.32458114624442147e-06, 2.38418579102014251e-06, 2.44379043579588049e-06, 2.50339508057163583e-06, 2.56299972534740896e-06, 2.62260437012320030e-06, 2.68220901489901028e-06, 2.74181365967483932e-06, 2.80141830445068783e-06, 2.86102294922655626e-06, 2.92062759400244501e-06, 2.98023223877835451e-06, 3.03983688355428519e-06, 3.09944152833023747e-06, 3.15904617310621177e-06, 3.21865081788220852e-06, 3.27825546265822813e-06, 3.33786010743427104e-06, 3.39746475221033767e-06, 3.45706939698642844e-06, 3.51667404176254377e-06, 3.57627868653868409e-06, 3.63588333131484982e-06, 3.69548797609104139e-06, 3.75509262086725921e-06, 3.81469726564350372e-06, 3.87430191041977533e-06, 3.93390655519607447e-06, 3.99351119997240156e-06, 4.05311584474875702e-06, 4.11272048952514129e-06, 4.17232513430155478e-06, 4.23192977907799791e-06, 4.29153442385447111e-06, 4.35113906863097481e-06, 4.41074371340750942e-06, 4.47034835818407538e-06, 4.52995300296067309e-06, 4.58955764773730300e-06, 4.64916229251396551e-06, 4.70876693729066106e-06, 4.76837158206739007e-06, 4.82797622684415296e-06, 4.88758087162095016e-06, 4.94718551639778208e-06, 5.00679016117464915e-06, 5.06639480595155180e-06, 5.12599945072849045e-06, 5.18560409550546552e-06, 5.24520874028247744e-06, 5.30481338505952662e-06, 5.36441802983661350e-06, 5.42402267461373850e-06, 5.48362731939090203e-06, 5.54323196416810453e-06, 5.60283660894534642e-06, 5.66244125372262811e-06, 5.72204589849995005e-06, 5.78165054327731263e-06, 5.84125518805471630e-06, 5.90085983283216148e-06, 5.96046447760964858e-06, 6.02006912238717803e-06, 6.07967376716475026e-06, 6.13927841194236569e-06, 6.19888305672002474e-06, 6.25848770149772783e-06, 6.31809234627547540e-06, 6.37769699105326786e-06, 6.43730163583110563e-06, 6.49690628060898914e-06, 6.55651092538691882e-06, 6.61611557016489508e-06, 6.67572021494291836e-06, 6.73532485972098907e-06, 6.79492950449910763e-06, 6.85453414927727448e-06, 6.91413879405549003e-06, 6.97374343883375471e-06, 7.03334808361206894e-06, 7.09295272839043314e-06, 7.15255737316884774e-06, 7.21216201794731317e-06, 7.27176666272582984e-06, 7.33137130750439818e-06, 7.39097595228301861e-06, 7.45058059706169156e-06, 7.51018524184041745e-06, 7.56978988661919670e-06, 7.62939453139802974e-06, 7.68899917617691698e-06, 7.74860382095585887e-06, 7.80820846573485580e-06, 7.86781311051390822e-06, 7.92741775529301655e-06, 7.98702240007218120e-06, 8.04662704485140260e-06, 8.10623168963068118e-06, 8.16583633441001735e-06, 8.22544097918941155e-06, 8.28504562396886419e-06, 8.34465026874837570e-06, 8.40425491352794650e-06, 8.46385955830757702e-06, 8.52346420308726768e-06, 8.58306884786701890e-06, 8.64267349264683111e-06, 8.70227813742670473e-06, 8.76188278220664018e-06, 8.82148742698663789e-06, 8.88109207176669827e-06, 8.94069671654682177e-06, 9.00030136132700879e-06, 9.05990600610725976e-06, 9.11951065088757510e-06, 9.17911529566795524e-06, 9.23871994044840061e-06, 9.29832458522891162e-06, 9.35792923000948870e-06, 9.41753387479013227e-06, 9.47713851957084275e-06, 9.53674316435162058e-06, 9.59634780913246617e-06, 9.65595245391337994e-06, 9.71555709869436232e-06, 9.77516174347541374e-06, 9.83476638825653461e-06, 9.89437103303772537e-06, 9.95397567781898643e-06, 1.00135803226003182e-05, 1.00731849673817211e-05, 1.01327896121631957e-05, 1.01923942569447422e-05, 1.02519989017263611e-05, 1.03116035465080529e-05, 1.03712081912898179e-05, 1.04308128360716566e-05, 1.04904174808535695e-05, 1.05500221256355569e-05, 1.06096267704176192e-05, 1.06692314151997570e-05, 1.07288360599819705e-05, 1.07884407047642603e-05, 1.08480453495466267e-05, 1.09076499943290702e-05, 1.09672546391115913e-05, 1.10268592838941902e-05, 1.10864639286768675e-05, 1.11460685734596236e-05, 1.12056732182424588e-05, 1.12652778630253737e-05, 1.13248825078083687e-05, 1.13844871525914441e-05, 1.14440917973746004e-05, 1.15036964421578380e-05, 1.15633010869411573e-05, 1.16229057317245588e-05, 1.16825103765080429e-05, 1.17421150212916100e-05, 1.18017196660752606e-05, 1.18613243108589950e-05, 1.19209289556428136e-05, 1.19805336004267170e-05, 1.20401382452107055e-05, 1.20997428899947796e-05, 1.21593475347789396e-05, 1.22189521795631860e-05, 1.22785568243475193e-05, 1.23381614691319398e-05, 1.23977661139164479e-05, 1.24573707587010442e-05, 1.25169754034857289e-05, 1.25765800482705026e-05, 1.26361846930553657e-05, 1.26957893378403185e-05, 1.27553939826253616e-05, 1.28149986274104953e-05, 1.28746032721957200e-05, 1.29342079169810363e-05, 1.29938125617664444e-05, 1.30534172065519449e-05, 1.31130218513375381e-05, 1.31726264961232244e-05, 1.32322311409090044e-05, 1.32918357856948784e-05, 1.33514404304808469e-05, 1.34110450752669102e-05, 1.34706497200530688e-05, 1.35302543648393231e-05, 1.35898590096256736e-05, 1.36494636544121206e-05, 1.37090682991986646e-05, 1.37686729439853060e-05, 1.38282775887720452e-05, 1.38878822335588827e-05, 1.39474868783458189e-05, 1.40070915231328542e-05, 1.40666961679199890e-05, 1.41263008127072237e-05, 1.41859054574945589e-05, 1.42455101022819948e-05, 1.43051147470695320e-05, 1.43647193918571707e-05, 1.44243240366449116e-05, 1.44839286814327550e-05, 1.45435333262207012e-05, 1.46031379710087508e-05, 1.46627426157969042e-05, 1.47223472605851617e-05, 1.47819519053735239e-05, 1.48415565501619911e-05, 1.49011611949505637e-05, 1.49607658397392423e-05, 1.50203704845280271e-05, 1.50799751293169186e-05, 1.51395797741059173e-05, 1.51991844188950236e-05, },
        { 0.00000000000000000e+00, 2.32830643653869629e-10, 4.65661287307739258e-10, 6.98491930961608887e-10, 9.31322574615478516e-10, 1.16415321826934815e-09, 1.39698386192321777e-09, 1.62981450557708740e-09, 1.86264514923095703e-09, 2.09547579288482666e-09, 2.32830643653869629e-09, 2.56113708019256592e-09, 2.79396772384643555e-09, 3.02679836750030519e-09, 3.25962901115417482e-09, 3.49245965480804445e-09, 3.72529029846191408e-09, 3.95812094211578371e-09, 4.19095158576965334e-09, 4.42378222942352298e-09, 4.65661287307739261e-09, 4.88944351673126225e-09, 5.12227416038513188e-09, 5.35510480403900152e-09, 5.58793544769287115e-09, 5.82076609134674079e-09, 6.05359673500061043e-09, 6.28642737865448006e-09, 6.51925802230834970e-09, 6.75208866596221934e-09, 6.98491930961608898e-09, 7.21774995326995862e-09, 7.45058059692382826e-09, 7.68341124057769790e-09, 7.91624188423156755e-09, 8.14907252788543719e-09, 8.38190317153930684e-09, 8.61473381519317648e-09, 8.84756445884704613e-09, 9.08039510250091578e-09, 9.31322574615478543e-09, 9.54605638980865508e-09, 9.77888703346252473e-09, 1.00117176771163944e-08, 1.02445483207702640e-08, 1.04773789644241337e-08, 1.07102096080780033e-08, 1.09430402517318730e-08, 1.11758708953857427e-08, 1.14087015390396123e-08, 1.16415321826934820e-08, 1.18743628263473516e-08, 1.21071934700012213e-08, 1.23400241136550910e-08, 1.25728547573089606e-08, 1.28056854009628303e-08, 1.30385160446167000e-08, 1.32713466882705696e-08, 1.35041773319244393e-08, 1.37370079755783090e-08, 1.39698386192321786e-08, 1.42026692628860483e-08, 1.44354999065399180e-08, 1.46683305501937877e-08, 1.49011611938476574e-08, 1.51339918375015270e-08, 1.53668224811553967e-08, 1.55996531248092664e-08, 1.58324837684631361e-08, 1.60653144121170058e-08, 1.62981450557708755e-08, 1.65309756994247452e-08, 1.67638063430786149e-08, 1.69966369867324845e-08, 1.72294676303863542e-08, 1.74622982740402239e-08, 1.76951289176940936e-08, 1.79279595613479633e-08, 1.81607902050018331e-08, 1.83936208486557028e-08, 1.86264514923095725e-08, 1.88592821359634422e-08, 1.90921127796173119e-08, 1.93249434232711816e-08, 1.95577740669250513e-08, 1.97906047105789210e-08, 2.00234353542327908e-08, 2.02562659978866605e-08, 2.04890966415405302e-08, 2.07219272851943999e-08, 2.09547579288482697e-08, 2.11875885725021394e-08, 2.14204192161560091e-08, 2.16532498598098789e-08, 2.18860805034637486e-08, 2.21189111471176184e-08, 2.23517417907714881e-08, 2.25845724344253578e-08, 2.28174030780792276e-08, 2.30502337217330973e-08, 2.32830643653869671e-08, 2.35158950090408369e-08, 2.37487256526947066e-08, 2.39815562963485764e-08, 2.42143869400024461e-08, 2.44472175836563159e-08, 2.46800482273101857e-08, 2.49128788709640554e-08, 2.51457095146179252e-08, 2.53785401582717950e-08, 2.56113708019256648e-08, 2.58442014455795346e-08, 2.60770320892334043e-08, 2.63098627328872741e-08, 2.65426933765411439e-08, 2.67755240201950137e-08, 2.70083546638488835e-08, 2.72411853075027533e-08, 2.74740159511566231e-08, 2.77068465948104929e-08, 2.79396772384643627e-08, 2.81725078821182326e-08, 2.84053385257721024e-08, 2.86381691694259722e-08, 2.88709998130798420e-08, 2.91038304567337118e-08, 2.93366611003875817e-08, 2.95694917440414515e-08, 2.98023223876953213e-08, 3.00351530313491912e-08, 3.02679836750030610e-08, 3.05008143186569308e-08, 3.07336449623108007e-08, 3.09664756059646705e-08, 3.11993062496185404e-08, 3.14321368932724103e-08, 3.16649675369262801e-08, 3.18977981805801500e-08, 3.21306288242340198e-08, 3.23634594678878897e-08, 3.25962901115417596e-08, 3.28291207551956295e-08, 3.30619513988494994e-08, 3.32947820425033692e-08, 3.35276126861572391e-08, 3.37604433298111090e-08, 3.39932739734649789e-08, 3.42261046171188488e-08, 3.44589352607727187e-08, 3.46917659044265886e-08, 3.49245965480804585e-08, 3.51574271917343285e-08, 3.53902578353881984e-08, 3.56230884790420683e-08, 3.58559191226959382e-08, 3.60887497663498081e-08, 3.63215804100036781e-08, 3.65544110536575480e-08, 3.67872416973114180e-08, 3.70200723409652879e-08, 3.72529029846191579e-08, 3.74857336282730278e-08, 3.77185642719268978e-08, 3.79513949155807677e-08, 3.81842255592346377e-08, 3.84170562028885077e-08, 3.86498868465423776e-08, 3.88827174901962476e-08, 3.91155481338501176e-08, 3.93483787775039876e-08, 3.95812094211578576e-08, 3.98140400648117276e-08, 4.00468707084655976e-08, 4.02797013521194676e-08, 4.05125319957733376e-08, 4.07453626394272076e-08, 4.09781932830810776e-08, 4.12110239267349476e-08, 4.14438545703888177e-08, 4.16766852140426877e-08, 4.19095158576965577e-08, 4.21423465013504278e-08, 4.23751771450042978e-08, 4.26080077886581679e-08, 4.28408384323120379e-08, 4.30736690759659080e-08, 4.33064997196197781e-08, 4.35393303632736481e-08, 4.37721610069275182e-08, 4.40049916505813883e-08, 4.42378222942352583e-08, 4.44706529378891284e-08, 4.47034835815429985e-08, 4.49363142251968686e-08, 4.51691448688507387e-08, 4.54019755125046088e-08, 4.56348061561584789e-08, 4.58676367998123491e-08, 4.61004674434662192e-08, 4.63332980871200893e-08, 4.65661287307739594e-08, 4.67989593744278296e-08, 4.70317900180816997e-08, 4.72646206617355699e-08, 4.74974513053894400e-08, 4.77302819490433102e-08, 4.79631125926971803e-08, 4.81959432363510505e-08, 4.84287738800049207e-08, 4.86616045236587909e-08, 4.88944351673126610e-08, 4.91272658109665312e-08, 4.93600964546204014e-08, 4.95929270982742716e-08, 4.98257577419281418e-08, 5.00585883855820120e-08, 5.02914190292358822e-08, 5.05242496728897525e-08, 5.07570803165436227e-08, 5.09899109601974929e-08, 5.12227416038513632e-08, 5.14555722475052334e-08, 5.16884028911591036e-08, 5.19212335348129739e-08, 5.21540641784668442e-08, 5.23868948221207144e-08, 5.26197254657745847e-08, 5.28525561094284550e-08, 5.30853867530823253e-08, 5.33182173967361955e-08, 5.35510480403900658e-08, 5.37838786840439361e-08, 5.40167093276978064e-08, 5.42495399713516768e-08, 5.44823706150055471e-08, 5.47152012586594174e-08, 5.49480319023132877e-08, 5.51808625459671581e-08, 5.54136931896210284e-08, 5.56465238332748987e-08, 5.58793544769287691e-08, 5.61121851205826395e-08, 5.63450157642365098e-08, 5.65778464078903802e-08, 5.68106770515442506e-08, 5.70435076951981210e-08, 5.72763383388519913e-08, 5.75091689825058617e-08, 5.77419996261597321e-08, 5.79748302698136026e-08, 5.82076609134674730e-08, 5.84404915571213434e-08, 5.86733222007752138e-08, 5.89061528444290842e-08, 5.91389834880829547e-08, 5.93718141317368251e-08, },
    };
    #elif xuse_math_tan_lut8x16
    constexpr xalign(64) f64 lut[][16] = {
        // 1st-pack
        {0.000000000000000000e+00, 6.258150756627501466e-02, 1.256551365751309678e-01, 1.897286107180591329e-01, 2.553419212210362665e-01, 3.230862443517455201e-01, 3.936265759256327582e-01, 4.677300254523917999e-01, 5.463024898437905133e-01, 6.304376738358847669e-01, 7.214844409909044200e-01, 8.211418015898941219e-01, 9.315964599440724612e-01, 1.055727639411919907e+00, 1.197421629234347972e+00, 1.362071976376228231e+00, },
        {0.000000000000000000e+00, 3.906269868336191839e-03, 7.812658949600007638e-03, 1.171928647127224492e-02, 1.562627168994382379e-02, 1.953373390588028856e-02, 2.344179247759764246e-02, 2.735056683645330104e-02, 3.126017650125595642e-02, 3.517074109289815333e-02, 3.908238034901538753e-02, 4.299521413867554942e-02, 4.690936247710254911e-02, 5.082494554043797425e-02, 5.474208368054464933e-02, 5.866089743985598348e-02, },
        {0.000000000000000000e+00, 2.441406298506385251e-04, 4.882812888051109764e-04, 7.324220059672651578e-04, 9.765628104409766290e-04, 1.220703731330162583e-03, 1.464844797738795724e-03, 1.708986038770918145e-03, 1.953127483530655208e-03, 2.197269161122229419e-03, 2.441411100649974307e-03, 2.685553331218348303e-03, 2.929695881931948620e-03, 3.173838781895525128e-03, 3.417982060213994235e-03, 3.662125745992452765e-03, },
        {0.000000000000000000e+00, 1.525878906368423789e-05, 3.051757813447390315e-05, 4.577636721947442314e-05, 6.103515632579122526e-05, 7.629394546052973696e-05, 9.155273463079538573e-05, 1.068115238436935991e-04, 1.220703131063298048e-04, 1.373291024258094305e-04, 1.525878918092379040e-04, 1.678466812637206533e-04, 1.831054707963631064e-04, 1.983642604142706917e-04, 2.136230501245488375e-04, 2.288818399343029724e-04, },

        // 2nd-pack
        {0.000000000000000000e+00, 9.536743164065391206e-07, 1.907348632814812965e-06, 2.861022949226556256e-06, 3.814697265643503717e-06, 4.768371582067390072e-06, 5.722045898499950045e-06, 6.675720214942918359e-06, 7.629394531398029737e-06, 8.583068847867018902e-06, 9.536743164351620579e-06, 1.049041748085356949e-05, 1.144409179737460036e-05, 1.239776611391644791e-05, 1.335144043048084687e-05, 1.430511474706953196e-05, },
        {0.000000000000000000e+00, 5.960464477539069559e-08, 1.192092895507818147e-07, 1.788139343261737808e-07, 2.384185791015670175e-07, 2.980232238769619483e-07, 3.576278686523589966e-07, 4.172325134277585860e-07, 4.768371582031611401e-07, 5.364418029785670823e-07, 5.960464477539768361e-07, 6.556510925293908251e-07, 7.152557373048094727e-07, 7.748603820802332026e-07, 8.344650268556624382e-07, 8.940696716310976030e-07, },
        {0.000000000000000000e+00, 3.725290298461914080e-09, 7.450580596923828263e-09, 1.117587089538574265e-08, 1.490116119384765735e-08, 1.862645149230957247e-08, 2.235174179077148810e-08, 2.607703208923340435e-08, 2.980232238769532132e-08, 3.352761268615723913e-08, 3.725290298461915786e-08, 4.097819328308107763e-08, 4.470348358154299853e-08, 4.842877388000492067e-08, 5.215406417846684416e-08, 5.587935447692876910e-08, },
        {0.000000000000000000e+00, 2.328306436538696289e-10, 4.656612873077392579e-10, 6.984919309616088868e-10, 9.313225746154785159e-10, 1.164153218269348145e-09, 1.396983861923217774e-09, 1.629814505577087404e-09, 1.862645149230957033e-09, 2.095475792884826663e-09, 2.328306436538696293e-09, 2.561137080192565924e-09, 2.793967723846435554e-09, 3.026798367500305185e-09, 3.259629011154174816e-09, 3.492459654808044448e-09, },
    };
    #endif

    extern f64 tan_unsafe(f64 x){
        // 作者吐槽：_mmxxx_i32gather_xxx 让作者很失望，好看不好用，性能还不及分次单独访问内存
        using namespace inc;

        auto m    = mf64{x};
        auto deci = 
            m.real_exp() < 0 ? 
            m.real_dec() >> -m.real_exp() : 
            m.real_dec() <<  m.real_exp();

        auto prec = m.decimal_bits() - 32;
        auto olde = m.real_exp();
        auto e    = prec - olde;
        auto t    = m;
        auto r0   = f64(0);
        auto r1   = f64(0);
        auto r2   = f64(0);
        auto r3   = f64(0);

        if (e > 0){
            m.decimal >>= e;
            m.decimal <<= e;

            // 线性区 tan(x) == x when x -> 1/inf (default about 1e-10)
            // 分隔   tan(A + x) when A >= 1.0
            // A 为非线性区的部分，在此去除
            t     = t - m;
        }

        #if xuse_math_tan_lut4x256
        union {
            struct{
                u64 i3 : 8;
                u64 i2 : 8;
                u64 i1 : 8;
                u64 i0 : 8;
            };
            u64 full;
        }idx;

        idx.full = deci >> 20;

        r0 = lut[0][idx.i0];
        r1 = lut[1][idx.i1];
        r2 = lut[2][idx.i2];
        r3 = lut[3][idx.i3];
        
        #elif xuse_math_tan_lut8x16
        union {
            struct{
                u64 i7 : 4;
                u64 i6 : 4;
                u64 i5 : 4;
                u64 i4 : 4;

                u64 i3 : 4;
                u64 i2 : 4;
                u64 i1 : 4;
                u64 i0 : 4;
            };
            u64 full;
        }idx;

        idx.full = deci >> 20;

        {
            auto a0 = lut[0][idx.i0];
            auto b0 = lut[1][idx.i1];
            auto a1 = lut[2][idx.i2];
            auto b1 = lut[3][idx.i3];

            auto a2 = lut[4][idx.i4];
            auto b2 = lut[5][idx.i5];
            auto a3 = lut[6][idx.i6];
            auto b3 = lut[7][idx.i7];

            auto s0 = a0 + b0;
            auto s1 = a1 + b1;
            auto s2 = a2 + b2;
            auto s3 = a3 + b3;
            
            auto m0 = 1.0 - a0 * b0;
            auto m1 = 1.0 - a1 * b1;
            auto m2 = 1.0 - a2 * b2;
            auto m3 = 1.0 - a3 * b3;
            r0      = s0 / m0;
            r1      = s1 / m1;
            r2      = s2 / m2;
            r3      = s3 / m3;
        }
        #endif


        {
            auto tinf = (idx.full >> 32) != 0;
            auto a0 = r0;
            auto a1 = r1;
            auto a2 = t;
            auto b0 = r2;
            auto b1 = r3;
            auto b2 = tinf ? 1.557407724654902231 : 0.0;

            auto s0 = a0 + b0;
            auto s1 = a1 + b1;
            auto s2 = a2 + b2;

            auto m0 = 1.0 - a0 * b0;
            auto m1 = 1.0 - a1 * b1;
            auto m2 = 1.0 - a2 * b2;

            r0      = s0 / m0;
            r1      = s1 / m1;
            r2      = s2 / m2;
        }

        auto sum3 = r0 + r1;
        auto mix3 = 1.0 - r0 * r1;
        auto r    = (sum3 + r2 * mix3) / (mix3 - r2 * sum3);
        return m.sign ? -r : r;
    }
}

